<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>linux下显示IP来源的小工具-nali | Pyinx Blog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="ip地址,linux,nali," />
  

  <meta name="description" content="nali简介nali，名字取自中文“哪里”的拼音。nali包含一组命令行程序，其主要功能就是把一些网络工具的输出的IP字符串，附加上地理位置信息(使用纯真数据库)。例如218.65.137.1会变成218.65.137.1[广西南宁市 电信]。查询是在本地进行，并不会进行联网查询，所以效率方面不会有什么影响。目前包含以下几个命令：nalinali-dignali-nslookupnali-trac">
<meta property="og:type" content="article">
<meta property="og:title" content="linux下显示IP来源的小工具-nali">
<meta property="og:url" content="http://blog.itsir.org/2013/01/16/181/index.html">
<meta property="og:site_name" content="Pyinx Blog">
<meta property="og:description" content="nali简介nali，名字取自中文“哪里”的拼音。nali包含一组命令行程序，其主要功能就是把一些网络工具的输出的IP字符串，附加上地理位置信息(使用纯真数据库)。例如218.65.137.1会变成218.65.137.1[广西南宁市 电信]。查询是在本地进行，并不会进行联网查询，所以效率方面不会有什么影响。目前包含以下几个命令：nalinali-dignali-nslookupnali-trac">
<meta property="og:updated_time" content="2015-08-06T02:38:30.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="linux下显示IP来源的小工具-nali">
<meta name="twitter:description" content="nali简介nali，名字取自中文“哪里”的拼音。nali包含一组命令行程序，其主要功能就是把一些网络工具的输出的IP字符串，附加上地理位置信息(使用纯真数据库)。例如218.65.137.1会变成218.65.137.1[广西南宁市 电信]。查询是在本地进行，并不会进行联网查询，所以效率方面不会有什么影响。目前包含以下几个命令：nalinali-dignali-nslookupnali-trac">
  
  

  


  <link rel="stylesheet" href="/css/styles.css" type="text/css">
  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


</head>

<body>
  <div class="content-post">
  <a class="avatar" href="/archives">
    <img src="/images/avatar.jpg" alt="" />
  </a>
  <article id="post-181" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    <a class="post-title" href="/2013/01/16/181/">linux下显示IP来源的小工具-nali</a>

  </header>

  <div class="article-meta">
    <span>2013-01-16</span>

    <span> | </span>

    <span class="article-author">pyinx</span>

    <span> | </span>

    
  <span class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </span>


  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="nali简介"><a id="nali简介" name="nali简介"></a>nali简介</h2><div><br><br>nali，名字取自中文“哪里”的拼音。<br>nali包含一组命令行程序，其主要功能就是把一些网络工具的输出的IP字符串，附加上地理位置信息(使用纯真数据库)。<br>例如218.65.137.1会变成218.65.137.1[广西南宁市 电信]。<br>查询是在本地进行，并不会进行联网查询，所以效率方面不会有什么影响。<br>目前包含以下几个命令：<br><pre>nali<br>nali-dig<br>nali-nslookup<br>nali-traceroute<br>nali-tracepath<br>nali-ping</pre><br>使用这些命令的前提是，他们对应的命令必须存在。例如你要用nali-dig，必须保证dig是存在的。他们的用法和原始命令是一样的。例如nali-dig，用法就和dig一样。<br>大家可能注意到了nali这个命令，它可以对标准输出的IP串附加上地理信息。nali-*系列工具都是基于这个来实现的。<br><br></div>

<h2 id="下载"><a id="下载" name="下载"></a>下载</h2><div><br><pre>wget <a href="http://qqwry.googlecode.com/files/nali-0.2.tar.gz" target="_blank" rel="external">http://qqwry.googlecode.com/files/nali-0.2.tar.gz</a></pre><br></div>

<h2 id="安装"><a id="安装" name="安装"></a>安装</h2><div><br><pre>./configure –prefix=/usr &amp;&amp; make &amp;&amp; make install</pre><br></div>

<h2 id="使用"><a id="使用" name="使用"></a>使用</h2><div></div>

<h3 id="1、统计apache的访问记录"><a id="统计apache的访问记录" name="统计apache的访问记录"></a>1、统计apache的访问记录</h3><div><br><br>（可以统计哪个ip的访问量最多，并查看是来自哪里的）：<br>命令：<br><pre>cat /data/log/log_all | awk ‘{print $1}’ | sort | uniq -c | nali | sort -rnk1 | more</pre><br>输出结果：<br><pre>    2303 203.208.60.43[北京市 谷歌(中国)公司]<br>   1442 61.135.249.210[北京市 联通ADSL]<br>    827 124.207.205.1[北京市 电信通]<br>    607 121.14.53.65[广东省江门市 电信]<br>    493 117.63.249.59[江苏省常州市 电信]<br>    289 203.208.60.5[北京市 谷歌(中国)公司]<br>    272 203.208.60.47[北京市 谷歌(中国)公司]<br>    252 173.66.232.6[北美地区]<br>    240 61.185.198.110[陕西省西安市 电信ADSL]<br>    217 123.127.8.36[北京市 联通ADSL]<br>    217 113.233.255.7[辽宁省 联通]<br>    206 222.76.18.181[福建省福州市 电信ADSL]<br>    196 72.30.81.190[美国 yahoo蜘蛛]</pre><br></div>

<h3 id="2、使用traceroute"><a id="使用traceroute" name="使用traceroute"></a>2、使用traceroute</h3><div><br><br>命令：<br><pre>nali-traceroute www.google.com</pre><br>输出结果：<br><pre>traceroute to www.google.com (72.14.203.147[美国 加利福尼亚州山景市谷歌公司]), 30 hops max, 40 byte packets<br>1  61.189.23.129[辽宁省 联通] (61.189.23.129[辽宁省 联通])  16.628 ms  16.796 ms  16.891 ms<br>2  218.25.16.153[辽宁省沈阳市铁西区 /皇姑区联通] (218.25.16.153[辽宁省沈阳市铁西区 /皇姑区联通])  0.658 ms  0.691 ms  0.685 ms<br>3  218.61.253.201[辽宁省葫芦岛市 联通] (218.61.253.201[辽宁省葫芦岛市 联通])  7.976 ms  8.008 ms  8.001 ms<br>4  218.61.255.185[辽宁省 联通骨干网] (218.61.255.185[辽宁省 联通骨干网])  20.614 ms  20.643 ms  20.636 ms<br>5  219.158.9.57[北京市 联通ADSL] (219.158.9.57[北京市 联通ADSL])  29.274 ms  29.272 ms  29.264 ms<br>6  219.158.3.194[北京市 联通ADSL] (219.158.3.194[北京市 联通ADSL])  44.582 ms  44.464 ms  44.489 ms<br>7  219.158.27.118[北京市 联通ADSL] (219.158.27.118[北京市 联通ADSL])  82.249 ms  82.690 ms  82.648 ms<br>8  209.85.249.195[美国 加利福尼亚州山景市谷歌公司] (209.85.249.195[美国 加利福尼亚州山景市谷歌公司])  67.663 ms<br>   209.85.249.192[美国 加利福尼亚州山景市谷歌公司] (209.85.249.192[美国 加利福尼亚州山景市谷歌公司])  66.336 ms<br>   209.85.249.195[美国 加利福尼亚州山景市谷歌公司] (209.85.249.195[美国 加利福尼亚州山景市谷歌公司])  68.010 ms<br>9  209.85.250.90[美国 加利福尼亚州山景市谷歌公司] (209.85.250.90[美国 加利福尼亚州山景市谷歌公司])  97.320 ms<br>   209.85.250.86[美国 加利福尼亚州山景市谷歌公司] (209.85.250.86[美国 加利福尼亚州山景市谷歌公司])  112.428 ms<br>   209.85.250.90[美国 加利福尼亚州山景市谷歌公司] (209.85.250.90[美国 加利福尼亚州山景市谷歌公司])  99.948 ms<br>10  209.85.243.21[美国 加利福尼亚州山景市谷歌公司] (209.85.243.21[美国 加利福尼亚州山景市谷歌公司])  96.939 ms<br>    209.85.250.103[美国 加利福尼亚州山景市谷歌公司] (209.85.250.103[美国 加利福尼亚州山景市谷歌公司])  97.206 ms<br>    209.85.243.21[美国 加利福尼亚州山景市谷歌公司] (209.85.243.21[美国 加利福尼亚州山景市谷歌公司])  96.935 ms<br>11  209.85.241.158[美国 加利福尼亚州山景市谷歌公司] (209.85.241.158[美国 加利福尼亚州山景市谷歌公司])  120.577 ms  120.588 ms  120.543 ms<br>12  tx-in-f147.google.com (72.14.203.147[美国 加利福尼亚州山景市谷歌公司])  117.533 ms  117.623 ms  117.651 ms</pre><br>也就是说，nali这个命令，可以对标准输出的ip，附加上地理信息。同理，如果你不喜欢用nali-dig，那么也可以用dig ip|nali这样的命令。<br>如果你觉得输入nali-xxx麻烦，那么可以做一些alias，例如：<br><pre>alias traceroute=’nali-traceroute’<br>alias dig=’nali-dig’</pre><br><pre></pre><br></div>
      
    </div>

    
      

    

  </div>
</article>



<section class="disqus-comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>




</div>

  
<script>
  var disqus_shortname = 'pyinx';
  
  var disqus_url = 'http://blog.itsir.org/2013/01/16/181/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"undefined"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0]
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!-- 多说公共JS代码 end -->

</body>
</html>
